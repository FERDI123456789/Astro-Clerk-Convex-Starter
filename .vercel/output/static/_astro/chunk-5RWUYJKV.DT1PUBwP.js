const V=(e,s,n)=>!e&&n?C(n):x(s),C=e=>{const s=e.userId,n=e.user,i=e.sessionId,o=e.sessionStatus,r=e.sessionClaims;return{userId:s,user:n,sessionId:i,session:e.session,sessionStatus:o,sessionClaims:r,organization:e.organization,orgId:e.orgId,orgRole:e.orgRole,orgPermissions:e.orgPermissions,orgSlug:e.orgSlug,actor:e.actor,factorVerificationAge:e.factorVerificationAge}},x=e=>{const s=e.user?e.user.id:e.user,n=e.user,i=e.session?e.session.id:e.session,o=e.session,r=e.session?.status,t=e.session?e.session.lastActiveToken?.jwt?.claims:null,h=e.session?e.session.factorVerificationAge:null,v=o?.actor,d=e.organization,f=e.organization?e.organization.id:e.organization,l=d?.slug,a=d&&n?.organizationMemberships?.find(O=>O.organization.id===f),U=a&&a.permissions;return{userId:s,user:n,sessionId:i,session:o,sessionStatus:r,sessionClaims:t,organization:d,orgId:f,orgRole:a&&a.role,orgSlug:l,orgPermissions:U,actor:v,factorVerificationAge:h}},P="METHOD_CALLED";function D(e,s){return{event:P,eventSamplingRate:.1,payload:{method:e,...s}}}let u=[],g=0;const m=4;let T=0,I=e=>{let s=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(i){return n.lc=s.push(i),()=>{for(let r=g+m;r<u.length;)u[r]===i?u.splice(r,m):r+=m;let o=s.indexOf(i);~o&&(s.splice(o,1),--n.lc||n.off())}},notify(i,o){T++;let r=!u.length;for(let t of s)u.push(t,n.value,i,o);if(r){for(g=0;g<u.length;g+=m)u[g](u[g+1],u[g+2],u[g+3]);u.length=0}},off(){},set(i){let o=n.value;o!==i&&(n.value=i,n.notify(o))},subscribe(i){let o=n.listen(i);return i(n.value),o},value:e};return n};const Q=5,p=6,E=10;let F=(e,s,n,i)=>(e.events=e.events||{},e.events[n+E]||(e.events[n+E]=i(o=>{e.events[n].reduceRight((r,t)=>(t(r),r),{shared:{},...o})})),e.events[n]=e.events[n]||[],e.events[n].push(s),()=>{let o=e.events[n],r=o.indexOf(s);o.splice(r,1),o.length||(delete e.events[n],e.events[n+E](),delete e.events[n+E])}),G=1e3,_=(e,s)=>F(e,i=>{let o=s(i);o&&e.events[p].push(o)},Q,i=>{let o=e.listen;e.listen=(...t)=>(!e.lc&&!e.active&&(e.active=!0,i()),o(...t));let r=e.off;return e.events[p]=[],e.off=()=>{r(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let t of e.events[p])t();e.events[p]=[]}},G)},()=>{e.listen=o,e.off=r}}),N=(e,s,n)=>{Array.isArray(e)||(e=[e]);let i,o,r=()=>{if(o===T)return;o=T;let f=e.map(l=>l.get());if(!i||f.some((l,a)=>l!==i[a])){i=f;let l=s(...f);l&&l.then&&l.t?l.then(a=>{i===f&&t.set(a)}):(t.set(l),o=T)}},t=I(void 0),h=t.get;t.get=()=>(r(),h());let v,d=n?()=>{clearTimeout(v),v=setTimeout(r)}:r;return _(t,()=>{let f=e.map(l=>l.listen(d));return r(),()=>{for(let l of f)l()}}),t},c=(e,s)=>N(e,s),H=(e,s)=>N(e,s,!0),R=(e={})=>{let s=I(e);return s.setKey=function(n,i){let o=s.value;typeof i>"u"&&n in s.value?(s.value={...s.value},delete s.value[n],s.notify(o,n)):s.value[n]!==i&&(s.value={...s.value,[n]:i},s.notify(o,n))},s};var A=R({isLoaded:!1,client:void 0,user:void 0,session:void 0,organization:void 0}),$=R(),S=I(null);c([A],e=>e.isLoaded);var z=H([A,$],(e,s)=>V(e.isLoaded,{session:e.session,user:e.user,organization:e.organization,client:e.client},s));c([z],e=>e.user);c([z],e=>e.session);var q=c([z],e=>e.organization),L=c([A],e=>e.client),B=c([S],e=>e);c([L],e=>e?.sessions);var Y=c([L],e=>e?.signIn),w=c([L],e=>e?.signUp);c([S],e=>e?.billing);var M=(e,s)=>{_(e,()=>{S.get()?.telemetry?.record(D(s))})};M(Y,"$signInStore");M(w,"$signUpStore");M(q,"$organizationStore");export{S as $,A as a,B as b,$ as c,z as d,V as e,c as f,D as g};
