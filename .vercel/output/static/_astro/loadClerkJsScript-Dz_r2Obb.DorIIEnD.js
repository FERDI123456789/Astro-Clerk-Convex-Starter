const C=[".lcl.dev",".stg.dev",".lclstage.dev",".stgstage.dev",".dev.lclclerk.com",".stg.lclclerk.com",".accounts.lclclerk.com","accountsstage.dev","accounts.dev"],b=e=>typeof atob<"u"&&typeof atob=="function"?atob(e):typeof global<"u"&&global.Buffer?new global.Buffer(e,"base64").toString():e,w="pk_live_",U="pk_test_";function k(e){if(!e.endsWith("$"))return!1;const r=e.slice(0,-1);return r.includes("$")?!1:r.includes(".")}function p(e,r={}){if(e=e||"",!e||!m(e)){if(r.fatal&&!e)throw new Error("Publishable key is missing. Ensure that your publishable key is correctly configured. Double-check your environment configuration for your keys, or access them here: https://dashboard.clerk.com/last-active?path=api-keys");if(r.fatal&&!m(e))throw new Error("Publishable key not valid.");return null}const t=e.startsWith(w)?"production":"development";let s;try{s=b(e.split("_")[2])}catch{if(r.fatal)throw new Error("Publishable key not valid: Failed to decode key.");return null}if(!k(s)){if(r.fatal)throw new Error("Publishable key not valid: Decoded key has invalid format.");return null}let o=s.slice(0,-1);return r.proxyUrl?o=r.proxyUrl:t!=="development"&&r.domain&&r.isSatellite&&(o=`clerk.${r.domain}`),{instanceType:t,frontendApi:o}}function m(e=""){try{if(!(e.startsWith(w)||e.startsWith(U)))return!1;const r=e.split("_");if(r.length!==3)return!1;const t=r[2];return t?k(b(t)):!1}catch{return!1}}function x(){const e=new Map;return{isDevOrStagingUrl:r=>{if(!r)return!1;const t=typeof r=="string"?r:r.hostname;let s=e.get(t);return s===void 0&&(s=C.some(o=>t.endsWith(o)),e.set(t,s)),s}}}var O=class E extends Error{static kind="ClerkError";clerkError=!0;code;longMessage;docsUrl;cause;get name(){return this.constructor.name}constructor(r){super(new.target.formatMessage(new.target.kind,r.message,r.code,r.docsUrl),{cause:r.cause}),Object.setPrototypeOf(this,E.prototype),this.code=r.code,this.docsUrl=r.docsUrl,this.longMessage=r.longMessage,this.cause=r.cause}toString(){return`[${this.name}]
Message:${this.message}`}static formatMessage(r,t,s,o){const n="Clerk:",l=new RegExp(n.replace(" ","\\s*"),"i");return t=t.replace(l,""),t=`${n} ${t.trim()}

(code="${s}")

`,o&&(t+=`

Docs: ${o}`),t}};const T=Object.freeze({InvalidProxyUrlErrorMessage:"The proxyUrl passed to Clerk is invalid. The expected value for proxyUrl is an absolute URL or a relative path with a leading '/'. (key={{url}})",InvalidPublishableKeyErrorMessage:"The publishableKey passed to Clerk is invalid. You can get your Publishable key at https://dashboard.clerk.com/last-active?path=api-keys. (key={{key}})",MissingPublishableKeyErrorMessage:"Missing publishableKey. You can get your key at https://dashboard.clerk.com/last-active?path=api-keys.",MissingSecretKeyErrorMessage:"Missing secretKey. You can get your key at https://dashboard.clerk.com/last-active?path=api-keys.",MissingClerkProvider:"{{source}} can only be used within the <ClerkProvider /> component. Learn more: https://clerk.com/docs/components/clerk-provider"});function I({packageName:e,customMessages:r}){let t=e;function s(n,l){if(!l)return`${t}: ${n}`;let u=n;const c=n.matchAll(/{{([a-zA-Z0-9-_]+)}}/g);for(const i of c){const a=(l[i[1]]||"").toString();u=u.replace(`{{${i[1]}}}`,a)}return`${t}: ${u}`}const o={...T,...r};return{setPackageName({packageName:n}){return typeof n=="string"&&(t=n),this},setMessages({customMessages:n}){return Object.assign(o,n||{}),this},throwInvalidPublishableKeyError(n){throw new Error(s(o.InvalidPublishableKeyErrorMessage,n))},throwInvalidProxyUrl(n){throw new Error(s(o.InvalidProxyUrlErrorMessage,n))},throwMissingPublishableKeyError(){throw new Error(s(o.MissingPublishableKeyErrorMessage))},throwMissingSecretKeyError(){throw new Error(s(o.MissingSecretKeyErrorMessage))},throwMissingClerkProviderError(n){throw new Error(s(o.MissingClerkProvider,n))},throw(n){throw new Error(s(n))}}}var f=class v extends O{static kind="ClerkRuntimeError";clerkRuntimeError=!0;constructor(r,t){super({...t,message:r}),Object.setPrototypeOf(this,v.prototype)}};const D={initialDelay:125,maxDelayBetweenRetries:0,factor:2,shouldRetry:(e,r)=>r<5,retryImmediately:!1,jitter:!0},$=100,P=async e=>new Promise(r=>setTimeout(r,e)),R=(e,r)=>r?e*(1+Math.random()):e,K=e=>{let r=0;const t=()=>{const s=e.initialDelay,o=e.factor;let n=s*Math.pow(o,r);return n=R(n,e.jitter),Math.min(e.maxDelayBetweenRetries||n,n)};return async()=>{await P(t()),r++}},A=async(e,r={})=>{let t=0;const{shouldRetry:s,initialDelay:o,maxDelayBetweenRetries:n,factor:l,retryImmediately:u,jitter:c,onBeforeRetry:i}={...D,...r},a=K({initialDelay:o,maxDelayBetweenRetries:n,factor:l,jitter:c});for(;;)try{return await e()}catch(d){if(t++,!s(d,t))throw d;i&&await i(t),u&&t===1?await P(R($,c)):await a()}},L="loadScript cannot be called when document does not exist",j="loadScript cannot be called without a src";async function B(e="",r){const{async:t,defer:s,beforeLoad:o,crossOrigin:n,nonce:l}=r||{};return A(()=>new Promise((c,i)=>{e||i(new Error(j)),(!document||!document.body)&&i(new Error(L));const a=document.createElement("script");n&&a.setAttribute("crossorigin",n),a.async=t||!1,a.defer=s||!1,a.addEventListener("load",()=>{a.remove(),c(a)}),a.addEventListener("error",d=>{a.remove(),i(d.error??new Error(`failed to load script: ${e}`))}),a.src=e,a.nonce=l,o?.(a),document.body.appendChild(a)}),{shouldRetry:(c,i)=>i<=5})}function F(e){return e?N(e)||M(e):!0}function N(e){return/^http(s)?:\/\//.test(e||"")}function M(e){return e.startsWith("/")}function J(e){return e?M(e)?new URL(e,window.location.origin).toString():e:""}function Y(e){if(!e)return"";let r;if(e.match(/^(clerk\.)+\w*$/))r=/(clerk\.)*(?=clerk\.)/;else{if(e.match(/\.clerk.accounts/))return e;r=/^(clerk\.)*/gi}return`clerk.${e.replace(r,"")}`}const W=(e,r="5.122.0")=>{if(e)return e;const t=H(r);return t?t==="snapshot"?"5.122.0":t:V(r)},H=e=>e.trim().replace(/^v/,"").match(/-(.+?)(\.|$)/)?.[1],V=e=>e.trim().replace(/^v/,"").split(".")[0],S="failed_to_load_clerk_js",z="failed_to_load_clerk_js_timeout",h="Failed to load Clerk",{isDevOrStagingUrl:X}=x(),_=I({packageName:"@clerk/shared"});function ee(e){_.setPackageName({packageName:e})}function y(){if(typeof window>"u"||!window.Clerk)return!1;const e=window.Clerk;return typeof e=="object"&&typeof e.load=="function"}function q(e){if(typeof window>"u"||!window.performance)return!1;const r=performance.getEntriesByName(e,"resource");if(r.length===0)return!1;const t=r[r.length-1];return t.transferSize===0&&t.decodedBodySize===0&&(t.responseEnd===0||t.responseEnd>0&&t.responseStart>0||"responseStatus"in t&&(t.responseStatus>=400||t.responseStatus===0))}function g(e,r){return new Promise((t,s)=>{let o=!1;const n=(a,d)=>{clearTimeout(a),clearInterval(d)};r?.addEventListener("error",()=>{n(c,i),s(new f(h,{code:S}))});const l=()=>{o||y()&&(o=!0,n(c,i),t(null))},c=setTimeout(()=>{o||(o=!0,n(c,i),y()?t(null):s(new f(h,{code:z})))},e);l();const i=setInterval(()=>{if(o){clearInterval(i);return}l()},100)})}const re=async e=>{const r=e?.scriptLoadTimeout??15e3;if(y())return null;if(!e?.publishableKey)return _.throwMissingPublishableKeyError(),null;const t=G(e),s=document.querySelector("script[data-clerk-js-script]");if(s)if(q(t))s.remove();else try{return await g(r,s),null}catch{s.remove()}const o=g(r);return B(t,{async:!0,crossOrigin:"anonymous",nonce:e.nonce,beforeLoad:Q(e)}).catch(n=>{throw new f(h+(n.message?`, ${n.message}`:""),{code:S,cause:n})}),o},G=e=>{const{clerkJSUrl:r,clerkJSVariant:t,clerkJSVersion:s,proxyUrl:o,domain:n,publishableKey:l}=e;if(r)return r;let u="";o&&F(o)?u=J(o).replace(/http(s)?:\/\//,""):n&&!X(p(l)?.frontendApi||"")?u=Y(n):u=p(l)?.frontendApi||"";const c=t?`${t.replace(/\.+$/,"")}.`:"",i=W(s);return`https://${u}/npm/@clerk/clerk-js@${i}/dist/clerk.${c}browser.js`},Z=e=>{const r={};return e.publishableKey&&(r["data-clerk-publishable-key"]=e.publishableKey),e.proxyUrl&&(r["data-clerk-proxy-url"]=e.proxyUrl),e.domain&&(r["data-clerk-domain"]=e.domain),e.nonce&&(r.nonce=e.nonce),r},Q=e=>r=>{const t=Z(e);for(const s in t)r.setAttribute(s,t[s])};export{I as b,m as i,re as l,ee as s};
